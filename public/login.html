<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="csrf-token" content="{{CSRF_TOKEN}}" />
  <title>Acceso | Consultorio Dental</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b1420;
      --bg-2: #0e1a28;
      --card: #0f172aCC; /* slate-900 with alpha */
      --text: #e6f3ff;
      --muted:#a9bfd6;
      --line:#1f2d3d;
      --brand:#2ec4b6; /* teal */
      --brand-2:#4cc9f0; /* aqua */
      --danger:#ef476f;
      --warning:#ffd166;
      --radius: 16px;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --field: #0b1220; 
      --focus: 0 0 0 3px rgba(76, 201, 240, .45), 0 8px 24px rgba(0,0,0,.35);
      --max: 1080px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#eef6fb; --bg-2:#e7f1f7; --card:#ffffffE6; --text:#0b2239; --muted:#51667a; --line:#d7e2ea; --field:#f6fbff; }
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      color:var(--text); background:radial-gradient(1000px 600px at 10% -10%, #153b5f 0%, transparent 60%),
               radial-gradient(900px 500px at 110% 20%, #0c4a6e 0%, transparent 55%),
               linear-gradient(160deg, var(--bg) 0%, var(--bg-2) 100%);
      display:grid; place-items:center; padding:24px;
    }
    .grid{
      width: min(100%, var(--max)); display:grid; grid-template-columns: repeat(12, 1fr); gap: 24px;
      align-items:center;
    }
    .brand{
      grid-column: 1 / span 6; display:none; position:relative; min-height: 560px;
    }
    @media (min-width: 980px){ .brand{ display:block } }
    .brand-card{
      position:relative; height:100%; border-radius: 28px; background: linear-gradient(160deg, rgba(46,196,182,.18), rgba(76,201,240,.14));
      border:1px solid rgba(76,201,240,.25); overflow:hidden; box-shadow: var(--shadow);
    }
    .tooth{
      position:absolute; inset:auto -60px -80px -60px; opacity:.20; filter: blur(1px);
      background:
        radial-gradient(160px 120px at 20% 20%, #ffffff33, transparent 70%),
        radial-gradient(220px 160px at 80% 10%, #4cc9f033, transparent 60%);
      mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path fill="white" d="M160.3 23.7c-22.9 0-34.2 10.9-32.3 32.6c1.9-21.7-9.4-32.6-32.3-32.6C55.3 23.7 32 48.6 32 83.7c0 52 27.7 68 43.4 68c15.7 0 14-42.6 24.6-42.6c13 0 9.3 70.9 28.1 70.9s15.1-70.9 28.1-70.9c10.6 0 8.9 42.6 24.6 42.6c15.7 0 43.4-16 43.4-68c0-35.1-23.3-60-63.9-60z"/></svg>') center / contain no-repeat;
    }
    .brand-content{
      position:absolute; inset:0; padding:40px; display:flex; flex-direction:column; justify-content:space-between;
    }
    .logo{
      display:flex; align-items:center; gap:14px; font-weight:700; letter-spacing:.2px;
    }
    .logo-badge{ width:48px; height:48px; border-radius:14px; display:grid; place-items:center; background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); box-shadow: inset 0 -4px 14px rgba(0,0,0,.15); }
    .logo svg{ width:28px; height:28px; }
    .slogan{ font-size:1.05rem; color:var(--muted); margin-top:8px }
    .benefits{ display:grid; gap:14px; margin-top:auto }
    .benefit{ padding:14px 16px; border:1px solid var(--line); border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); backdrop-filter: blur(6px); }

    /* Auth card */
    .auth{
      grid-column: 1 / -1; @media(min-width:980px){ grid-column: 8 / span 5; }
    }
    .card{ border-radius: 24px; background: var(--card); border: 1px solid var(--line); box-shadow: var(--shadow); overflow:hidden; }
    .card-head{ padding:32px 28px 0 28px; }
    .tabs{ display:flex; gap:12px; }
    .tab{ border:1px solid var(--line); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); padding:8px 14px; border-radius:100px; font-weight:600; color:var(--muted); cursor:pointer; }
    .tab[aria-selected="true"]{ color:var(--text); border-color:transparent; background: linear-gradient(135deg, rgba(46,196,182,.35), rgba(76,201,240,.35)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.15); }

    .card-body{ padding:24px 28px 32px 28px; }
    form{ display:grid; gap:16px; }
    .field{ display:grid; gap:8px; }
    label{ font-weight:600; }
    .control{ position:relative }
    input[type="email"], input[type="password"], input[type="text"], input[type="tel"], input[type="number"]{
      width:100%; padding:14px 44px 14px 14px; border-radius: 12px; background: var(--field);
      border:1px solid var(--line); color:var(--text); font: inherit; outline:none; box-shadow:none; transition:.25s;
    }
    input:focus{ border-color: transparent; box-shadow: var(--focus) }
    input::placeholder{ color: #8fa6bb }
    .toggle{ position:absolute; top:50%; right:10px; transform: translateY(-50%); border:0; background:transparent; cursor:pointer; color:var(--muted) }
    .msg{ display:flex; align-items:center; gap:8px; font-size:.95rem; color:var(--muted) }
    .msg.error{ color: var(--danger) }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .checkbox{ display:flex; align-items:center; gap:10px; user-select:none; }
    .checkbox input{ width:18px; height:18px }
    .link{ color: var(--brand-2); font-weight:600; text-decoration:none }

    .btn{ --h: 48px; height: var(--h); border-radius: 12px; border: 1px solid transparent; font-weight:700; letter-spacing:.2px; cursor:pointer; transition:.2s; display:inline-grid; place-items:center; padding:0 16px }
    .btn[disabled]{ opacity:.65; cursor:not-allowed; filter: grayscale(.3) }
    .btn-primary{ background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); color:#012231; box-shadow: 0 6px 20px rgba(76,201,240,.25) }
    .btn-primary:hover{ transform: translateY(-1px) }
    .btn-ghost{ background: transparent; border-color: var(--line); color: var(--text) }

    .providers{ display:grid; gap:10px; grid-template-columns: 1fr 1fr }

    .divider{ display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:12px; color:var(--muted) }
    .divider::before, .divider::after{ content:""; height:1px; background:var(--line) }

    .foot{ color:var(--muted); text-align:center; font-size:.95rem }

    /* Motion */
    @media (prefers-reduced-motion:no-preference){
      .card{ animation: pop .35s ease-out }
      @keyframes pop{ from{ transform: translateY(6px); opacity:0 } to{ transform:none; opacity:1 } }
    }
    .sr-only{ position:absolute !important; clip:rect(1px,1px,1px,1px); padding:0 !important; border:0 !important; height:1px !important; width:1px !important; overflow:hidden }

    /* Small tweaks */
    .caps{ display:none }
    .caps.on{ display:flex }
  </style>
</head>
<body>
  <main class="grid" aria-label="Acceso al sistema del consultorio dental">
    <aside class="brand" aria-hidden="true">
      <div class="brand-card">
        <div class="tooth"></div>
        <div class="brand-content">
          <div>
            <div class="logo" aria-label="Logo Consultorio Dental">
              <div class="logo-badge" aria-hidden="true">
                <svg viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M160.3 23.7c-22.9 0-34.2 10.9-32.3 32.6c1.9-21.7-9.4-32.6-32.3-32.6C55.3 23.7 32 48.6 32 83.7c0 52 27.7 68 43.4 68c15.7 0 14-42.6 24.6-42.6c13 0 9.3 70.9 28.1 70.9s15.1-70.9 28.1-70.9c10.6 0 8.9 42.6 24.6 42.6c15.7 0 43.4-16 43.4-68c0-35.1-23.3-60-63.9-60z" fill="white"/>
                </svg>
              </div>
              <span>Consultorio Dental</span>
            </div>
            <p class="slogan">Agenda, expedientes y recordatorios en un solo lugar.</p>
          </div>
          <div class="benefits">
            <div class="benefit">‚úîÔ∏è Gesti√≥n centralizada de citas y pacientes.</div>
            <div class="benefit">‚úîÔ∏è Acceso seguro desde cualquier dispositivo.</div>
            <div class="benefit">‚úîÔ∏è Optimiza el flujo de trabajo de tu cl√≠nica.</div>
          </div>
        </div>
      </div>
    </aside>

    <section class="auth">
      <div class="card" role="region" aria-labelledby="t-auth">
        <div class="card-head">
          <h1 id="t-auth" style="margin:0 0 12px 0; font-size:1.6rem">Inicia sesi√≥n</h1>
        </div>
        <div class="card-body">
          <form id="form-email" role="tabpanel" aria-labelledby="tab-email" autocomplete="on" novalidate>
            <div class="field">
              <label for="email">Correo electr√≥nico</label>
              <div class="control">
                <input id="email" name="email" type="email" inputmode="email" placeholder="admin@ejemplo.com" required aria-describedby="email-err" />
              </div>
              <div id="email-err" class="msg" aria-live="polite"></div>
            </div>

            <div class="field">
              <div class="row" style="justify-content:space-between">
                <label for="password">Contrase√±a</label>
                <span id="caps-note" class="msg caps">Bloq May√∫s activado</span>
              </div>
              <div class="control">
                <input id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" aria-describedby="pass-err" />
                <button type="button" class="toggle" aria-label="Mostrar u ocultar contrase√±a" id="toggle-pass">üëÅÔ∏è</button>
              </div>
              <div id="pass-err" class="msg" aria-live="polite"></div>
            </div>

            <button id="btn-login" class="btn btn-primary" type="submit">
              <span id="btn-text">Entrar</span>
              <span id="btn-spinner" class="sr-only" aria-hidden="true">‚è≥</span>
            </button>

            <div id="form-error" class="msg error" aria-live="assertive" style="display:none; margin-top: 10px;"></div>
          </form>
        </div>
      </div>
    </section>

  </main>

  <script type="module">
    // --- Importar Firebase ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // --- Configuraci√≥n de Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyBE7-GMIloH-SRJNIchtYh3ouI589_B508",
      authDomain: "clinicas-16ab1.firebaseapp.com",
      projectId: "clinicas-16ab1",
      storageBucket: "clinicas-16ab1.firebasestorage.app",
      messagingSenderId: "563780700167",
      appId: "1:563780700167:web:1f04058e4b06ae18bf02a2",
      measurementId: "G-TRT1DWPKGQ"
    };

    // --- Inicializar Firebase ---
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // --- Utilidades del DOM ---
    const $ = (s, r = document) => r.querySelector(s);
    
    // --- L√≥gica para la UI ---
    $('#toggle-pass').addEventListener('click', () => {
      const input = $('#password');
      input.type = input.type === 'password' ? 'text' : 'password';
    });

    const caps = $('#caps-note');
    $('#password').addEventListener('keyup', e => {
      if (e.getModifierState && e.getModifierState('CapsLock')) {
        caps.classList.add('on');
      } else {
        caps.classList.remove('on');
      }
    });
    
    function showErr(id, msg) { 
        const el = $(id); 
        if(!el) return; 
        el.textContent = msg || ''; 
        el.style.display = msg ? 'flex' : 'none'; 
    }

    // Verificar si el usuario ya est√° logueado
    onAuthStateChanged(auth, (user) => {
        if (user) {
            // Si ya hay una sesi√≥n activa, redirigir al panel principal
            console.log("Sesi√≥n activa, redirigiendo al panel...");
            window.location.href = 'index.html';
        }
    });

    // --- L√≥gica del formulario de login ---
    $('#form-email').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = $('#email').value.trim();
      const password = $('#password').value;
      
      let ok = true;
      if (!/.+@.+\..+/.test(email)) { showErr('#email-err', 'Ingresa un correo v√°lido.'); ok = false; } 
      else { showErr('#email-err'); }
      if (!password || password.length < 6) { showErr('#pass-err', 'La contrase√±a debe tener al menos 6 caracteres.'); ok = false; } 
      else { showErr('#pass-err'); }
      if (!ok) return;

      // Estado de carga en el bot√≥n
      const btn = $('#btn-login');
      const text = $('#btn-text');
      const spinner = $('#btn-spinner');
      btn.disabled = true; 
      text.textContent = 'Entrando‚Ä¶'; 
      spinner.classList.remove('sr-only');
      showErr('#form-error'); // Ocultar errores previos

      try {
        // Iniciar sesi√≥n con Firebase
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        console.log('Inicio de sesi√≥n exitoso:', userCredential.user.uid);
        // Redirecci√≥n al panel de administraci√≥n
        window.location.href = 'index.html';
      } catch (error) {
        console.error("Error de inicio de sesi√≥n:", error.code, error.message);
        let message = 'No se pudo iniciar sesi√≥n. Revisa tus datos.';
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
            message = 'Correo o contrase√±a incorrectos.';
        }
        showErr('#form-error', message);
      } finally {
        // Restaurar el bot√≥n a su estado normal
        btn.disabled = false; 
        text.textContent = 'Entrar'; 
        spinner.classList.add('sr-only');
      }
    });

  </script>
</body>
</html>